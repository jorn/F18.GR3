\section{Opsummering}

\subsection{FreeRTOS}
FreeRTOS benyttes som indlejret styresystem. FreeRTOS bruger preemptive skedulering til at administrere CPU-tiden for tasks. 

\subsection{Preemptive schedulering}
FreeRTOS' scheduleringsalgoritme er en prioritetsbaseret preemptive scheduler.
Dette vil sige at hver task bliver givet en prioritet, og hvis en task med en højere prioritet kommer i ready queuen bliver den nuværende task \textit{preemptet}.
Typisk benyttes der en prioritetsbaseret scheduleringsalgoritme på real-time systemer, fordi der skal gives et respons på en begivenhed inden for en vis deadline.



\subsection{Løsningsimplementering og task model}


\subsection{Intterrupt eksekvering og task skedulering}
Det indgående lydsignal samples periodisk på samme tidspunkt i hver periode. 
Det gøres ved hjælp af en ISR med højeste prioritet, som også er prioriteret over tasks. 
Timingen af ISR er kontrolleret af Timer 3.
Timeren er implementeret således, at der opnås en samplefrekvens på 44,1kHz. 
Alle andre processor opgaver skal derfor foregå i tiden mellem hver gang ISR sample handler rutinen kører. 

\subsection{Sampling af lydsignal igennem ADC}
Til sampling af signalet benyttes to 12-bit ADC moduler. 
Samplingen startes ved et processor event, som foregår i ISR sample handler rutinen. 
Det samplede data indeholder et offset fra input stage, som efter samplingen fjernes. 

\subsection{Modulær opbygning af effekter}
De enkelte effektmoduler holdes i en datastruktur indeholdende en \textit{function pointer} og en booleansk variabel.
For hver gang der bliver samplet bliver der itereret over en array af effektmodul data strukturen, og de indeholdende routiner bliver kaldet i samplehandleren som set på figur (\ref{fig:effektmoduler}).\newline
Det eneste der skal gøres for at tilføje et nyt modul er at tilføje et element til arrayen af effektmoduler, sætte \textit{function pointeren} til at pege på effektroutinen og sætte den booleanske variable til $\mathtt{TRUE}$.
Outputtet af hver effekt bruges som input til den næste således at der opnås en kaskadekobling af effekterne.


\section{Generering af PWM-signal til DAC}


\subsection{Genskabelse af signal via DAC igennem SPI}


\subsection{LCD Driver}
LCD-driveren virker ved at write funktioner smider deres resultater over i en buffer.
LCD-tasken er implementeret som en \textit{statemachine} (\ref{fig:LCD_state_machine}).
Når LCD-tasken kører bliver der itereret gennem LCD-bufferen og indholdet af bufferen skrives ud.


\subsection{Håndtering af brugergrænseflade og human input interface}
%Et modulært menu system er nødvendigt for at effektmoduler kan tilføres helt uafhængigt af systemet, det lykkedes dog ikke at producere et sådant system men det skyldtes dog blot tidsmangel og kunne nemt implementeres i det nuværende menu system i form af en software patch, derfor blev dette ned prioriteret så deadline kunne overholdes. 

Et menu system er udviklet til enheden, bestående af en datastruktur i form af en linked list og en state machine der skriver menuen til displayet.
Et modulært menu system er nødvendigt for at effektmoduler kan tilføres helt uafhængigt af systemet, dette er dog blevet nedpriorieteret grundet tidspres, og er derfor ikke gjort.
Input fra brugeren sker gennem to switches på TIVA-boardet, samt en drehimpulsgeber på EMP-boardet.
Der bliver pullet på switchesne og events bliver genereret af en statemachine og sendt ud til andre tasks, hvor rotation på drehimpulsgeberen trigger et interrupt der afgøre retningen af rotation.